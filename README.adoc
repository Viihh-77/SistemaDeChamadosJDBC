# RELATÓRIO DE IMPLEMENTAÇÃO — SISTEMA DE CHAMADOS

Este documento descreve, de forma clara e organizada, o comportamento esperado de cada serviço e de cada método para que todos os testes do Sistema de Chamados funcionem corretamente. As mensagens de exceção e as regras devem ser exatamente as especificadas.

---

## Resumo rápido
- Serviços: UsuarioService, ChamadoService, AtendimentoService, RelatorioService
- Regra geral: listas devem ser retornadas como listas (nunca null). Datas: usar `LocalDateTime.now()` quando indicado.
- Mensagens de exceção: usar exatamente os textos fornecidos nos descritores de cada método.

---

## Ordem recomendada de implementação
1. UsuarioService (obrigatório para ChamadoService)  
2. ChamadoService (necessário antes de iniciar atendimentos)  
3. AtendimentoService (depende do ChamadoService)  
4. RelatorioService (depende das tabelas Chamado + Usuario)  
5. Rodar todos os testes e ajustar conforme necessário

---

## 1. UsuarioService
Serviço responsável pelas operações básicas de usuário.

Métodos a implementar:

1. cadastrarUsuario(Usuario usuario)  
   - Parâmetros: `Usuario usuario`  
   - Retorno: `Usuario` (usuario cadastrado)  
   - Validações e lógica:
     - Se `usuario` for nulo → lançar `RuntimeException("Usuário inválido!")`
     - Se `nome` for nulo ou vazio → lançar `RuntimeException("Nome é obrigatório!")`
     - Se `email` for nulo ou vazio → lançar `RuntimeException("Email é obrigatório!")`
     - Salvar o usuário no banco.
     - Retornar o usuário salvo (com todos os campos preenchidos pelo banco).

2. buscarUsuarioPorId(long id)  
   - Parâmetros: `long id`  
   - Retorno: `Usuario`  
   - Lógica:
     - Buscar o usuário no banco.
     - Se não existir → lançar `RuntimeException("Usuário não encontrado!")`
     - Retornar o usuário encontrado.

---

## 2. ChamadoService
Serviço responsável pela abertura e consulta de chamados.

Métodos a implementar:

1. abrirChamado(Chamado chamado)  
   - Parâmetros: `Chamado chamado`  
   - Retorno: `Chamado` (chamado aberto)  
   - Validações e lógica:
     - Se `chamado` for nulo → lançar `RuntimeException("Chamado inválido!")`
     - Validar usuário associado:
       - Se `usuarioId` não existir no banco → lançar `RuntimeException("Usuário não encontrado!")`
     - Se `descricao` for nula ou vazia → lançar `RuntimeException("Descrição é obrigatória!")`
     - Definir campos antes de salvar:
       - `status = "ABERTO"`
       - `dataAbertura = LocalDateTime.now()`
     - Salvar o chamado no banco.
     - Retornar o chamado salvo.

2. buscarChamadoPorId(long id)  
   - Parâmetros: `long id`  
   - Retorno: `Chamado`  
   - Lógica:
     - Buscar no banco.
     - Se não existir → lançar `RuntimeException("Chamado não encontrado!")`
     - Retornar o chamado encontrado.

---

## 3. AtendimentoService
Serviço que controla o início e fim do atendimento de um chamado.

Métodos a implementar:

1. iniciarAtendimento(Atendimento atendimento)  
   - Parâmetros: `Atendimento atendimento`  
   - Retorno: `Atendimento` (atendimento iniciado)  
   - Validações e lógica:
     - Se `atendimento` for nulo → lançar `RuntimeException("Atendimento inválido!")`
     - Validar existência do chamado associado:
       - Se o chamado não existir → lançar `RuntimeException("Chamado não encontrado!")`
     - Verificar status do chamado:
       - Se o chamado não estiver com `status = "ABERTO"` → lançar `RuntimeException("Chamado não está aberto!")`
     - Preencher:
       - `dataInicio = LocalDateTime.now()`
     - Salvar o atendimento no banco.
     - Retornar o atendimento salvo.

2. finalizarAtendimento(long id, String solucao)  
   - Parâmetros: `long id`, `String solucao`  
   - Retorno: `Atendimento` (atendimento finalizado)  
   - Lógica:
     - Buscar atendimento por ID.
     - Se não existir → lançar `RuntimeException("Atendimento não encontrado!")`
     - Preencher:
       - `solucao =` solução recebida
       - `dataFim = LocalDateTime.now()`
     - Atualizar o registro no banco.
     - Retornar o atendimento finalizado.

---

## 4. RelatorioService
Serviço de consultas específicas e dados agregados.

Métodos a implementar:

1. listarChamadosAbertosPorPrioridade(String prioridade)  
   - Parâmetros: `String prioridade`  
   - Retorno: `List<ChamadoResumoDTO>`  
   - Lógica:
     - Buscar no banco chamados onde:
       - `status = "ABERTO"`
       - `prioridade = prioridade`
     - Retornar a lista (pode ser vazia, mas nunca `null`).

2. gerarRelatorioUsuariosComMaisChamados(int minimo)  
   - Parâmetros: `int minimo`  
   - Retorno: `List<UsuarioContagemChamadosDTO>`  
   - Lógica:
     - Se `minimo <= 0` → lançar `RuntimeException("Valor mínimo inválido!")`
     - Consultar no banco usuários com quantidade de chamados ≥ `minimo`.
     - Retornar a lista (vazia ou com dados).

3. buscarDetalhesChamado(long id)  
   - Parâmetros: `long id`  
   - Retorno: `Optional<ChamadoResumoDTO>`  
   - Lógica:
     - Se `id <= 0` → lançar `RuntimeException("ID inválido!")`
     - Buscar o chamado com join no usuário.
     - Se não encontrar → retornar `Optional.empty()`
     - Se encontrar → retornar `Optional.of(dto)`

---

## Observações e boas práticas
- Mantenha as mensagens de exceção exatamente como especificadas para que os testes unitários as validem corretamente.
- Sempre retorne coleções não nulas (use listas vazias quando não houver elementos).
- Use `LocalDateTime.now()` para preencher timestamps conforme indicado.
- Implemente e teste cada serviço na ordem recomendada para evitar dependências quebradas.

---
